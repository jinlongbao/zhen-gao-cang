# 织女高仓平台规范

## 为什么
本项目旨在为原创手工（特别是织女）创作者提供一个安全、可靠的作品分发平台，解决当前普遍存在的图解被盗用、倒卖的问题。通过引入强制性的、与购买者身份绑定的水印，以及社区驱动的黑名单机制，本项目致力于保护原创作者的劳动成果和合法权益。

## 主要变更
- **新建** 一个全栈 Web 应用，部署于 Cloudflare Pages。
- **新建** 用户系统，包含三种角色：买家 (buyer)、原创织女 (creator)、管理员 (admin)。
- **新建** 图解上传功能，允许原创织女上传其作品，文件存储于 Cloudflare R2。
- **新建** 图解授权和下载功能，买家获得授权后方可下载。
- **新建** 动态水印系统，在下载时，自动将买家的社交账号（微信号或小红书号）作为水印添加到图解上。
- **新建** 黑名单和举报系统，允许原创织女举报有盗卖行为的用户，并公开展示黑名单。
- **新建** 管理员后台，用于管理用户信息、授权和网站信息。

## 技术栈
- **前端**: Remix (或原生 HTML/JS 作为备选)
- **后端**: Cloudflare Workers (通过 Remix 后端实现)
- **数据库**: Cloudflare D1
- **对象存储**: Cloudflare R2
- **键值存储**: Cloudflare KV (用于缓存和会话)

## 新增需求

### 需求: 用户认证与角色系统
系统应提供一个安全的用户认证流程，并能区分三种不同的用户角色。

#### 场景: 用户注册
- **当** 一个新用户访问注册页面时
- **那么** 系统应提供表单让其输入用户名、密码，并选择注册为“买家”或“原创织女”。
- **并且** 注册成功后，用户信息将被存入 D1 数据库。

#### 场景: 用户登录
- **当** 一个已注册用户访问登录页面时
- **那么** 系统应提供表单让其输入用户名和密码。
- **并且** 登录成功后，系统应为其创建一个会话，并根据其角色导向不同的页面。

#### 场景: 管理员访问
- **当** 一个具有管理员角色的用户访问管理后台时
- **那么** 系统应允许其访问。
- **当** 一个非管理员用户尝试访问管理后台时
- **那么** 系统应拒绝访问并将其重定向。

### 需求: 图解上传与存储
系统应允许原创织女上传她们的图解作品。

#### 场景: 成功上传
- **当** 一位已登录的“原创织女”用户访问上传页面时
- **那么** 系统应提供一个表单，允许其上传图解文件（如图片或PDF）并填写标题、描述和价格。
- **并且** 上传成功后，文件应被存储在 R2，并在 D1 数据库中创建一条对应的图解记录。

### 需求: 水印与授权下载
系统核心功能，确保图解在分发过程中的安全性。

#### 场景: 授权与下载
- **当** 一位“原创织女”决定授权给某位“买家”下载某个图解时
- **那么** 系统应在 `authorizations` 表中创建一条记录。
- **当** 该“买家”访问下载链接时
- **那么** 系统应首先验证其授权状态。
- **并且** 验证通过后，系统从 R2 读取原始图解，将该“买家”的用户信息（如微信号）作为水印动态添加到图解上，然后将加了水印的文件提供给用户下载。

### 需求: 黑名单系统
社区自我保护机制，用于警示和防范盗图倒卖行为。

#### 场景: 举报用户
- **当** 一位“原创织女”举报某个用户时
- **那么** 系统应允许她提交举报，并在 `blacklist` 表中创建记录。
- **并且** 系统应提供一个公开的黑名单页面，展示所有被举报的用户信息。

#### 场景: 授权警示
- **当** “原创织女”准备授权给一个在黑名单上的用户时
- **那么** 系统应在授权界面给出明确的警示信息。
